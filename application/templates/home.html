<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FireGuard - AI Forest Fire Predictor</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

    <div class="main-title">
        <i class="fa-solid fa-fire-shield"></i> FireGuard
    </div>

    <div class="dashboard-container">
        
        <div class="glass-card input-panel">
            <div class="header">
                <i class="fa-solid fa-sliders"></i>
                <h2>Paramètres Météo</h2>
            </div>

            <form action="{{ url_for('predict') }}" method="POST">
                
                <div class="input-wrapper" id="grp-temp">
                    <div class="label-row">
                        <span><i class="fa-solid fa-temperature-full"></i> Température (°C)</span>
                        <span class="range-info">22°C - 42°C</span>
                    </div>
                    <div class="controls-row">
                        <input type="range" class="sync-range" data-target="Temperature" min="22" max="42" step="0.1" value="{{ temp if temp else 30 }}" data-color-type="temp">
                        <input type="number" step="0.1" id="Temperature" name="Temperature" class="num-input sync-input" min="22" max="42" value="{{ temp if temp else 30 }}" required>
                    </div>
                </div>

                <div class="input-wrapper" id="grp-rh">
                    <div class="label-row">
                        <span><i class="fa-solid fa-droplet"></i> Humidité Relative (%)</span>
                        <span class="range-info">21% - 90%</span>
                    </div>
                    <div class="controls-row">
                        <input type="range" class="sync-range" data-target="RH" min="21" max="90" step="1" value="{{ rh if rh else 50 }}" data-color-type="humidity">
                        <input type="number" step="1" id="RH" name="RH" class="num-input sync-input" min="21" max="90" value="{{ rh if rh else 50 }}" required>
                    </div>
                </div>

                <div class="input-wrapper" id="grp-ws">
                    <div class="label-row">
                        <span><i class="fa-solid fa-wind"></i> Vent (km/h)</span>
                        <span class="range-info">6 - 29 km/h</span>
                    </div>
                    <div class="controls-row">
                        <input type="range" class="sync-range" data-target="Ws" min="6" max="29" step="0.1" value="{{ ws if ws else 15 }}" data-color-type="wind">
                        <input type="number" step="0.1" id="Ws" name="Ws" class="num-input sync-input" min="6" max="29" value="{{ ws if ws else 15 }}" required>
                    </div>
                </div>

                <div class="input-wrapper" id="grp-rain">
                    <div class="label-row">
                        <span><i class="fa-solid fa-cloud-rain"></i> Pluie (mm)</span>
                        <span class="range-info">0 - 16.8 mm</span>
                    </div>
                    <div class="controls-row">
                        <input type="range" class="sync-range" data-target="Rain" min="0" max="16.8" step="0.1" value="{{ rain if rain else 0 }}" data-color-type="rain">
                        <input type="number" step="0.1" id="Rain" name="Rain" class="num-input sync-input" min="0" max="16.8" value="{{ rain if rain else 0 }}" required>
                    </div>
                </div>

                <button type="submit" class="btn-predict">
                    <i class="fa-solid fa-calculator"></i> Calculer le Risque
                </button>
            </form>
        </div>

        <div class="right-column">
            
            <div class="glass-card result-panel" style="margin-bottom: 2rem;">
                <div class="header">
                    <i class="fa-solid fa-chart-simple"></i>
                    <h2>Analyse de Risque</h2>
                </div>

                {% if prediction_text %}
                    <div class="result-box">
                        <div class="risk-badge {{ 'badge-low' if css_class == 'low-risk' else ('badge-med' if css_class == 'medium-risk' else 'badge-high') }}">
                            RÉSULTAT
                        </div>
                        <div class="risk-indicator {{ 'low-risk-color' if css_class == 'low-risk' else ('medium-risk-color' if css_class == 'medium-risk' else 'high-risk-color') }}">
                            {{ prediction_text.split(':')[1] }}
                        </div>
                        <h3>Index FWI</h3>
                        <p style="margin-top: 10px; color: var(--text-muted)">
                            Niveau : <span style="color: white; font-weight: bold;">{{ risk_text }}</span>
                        </p>
                    </div>
                {% else %}
                    <div class="empty-state">
                        <i class="fa-solid fa-tree" style="font-size: 3rem; color: #334155; margin-bottom: 1rem;"></i>
                        <p style="font-size: 0.9rem;">Lancez une prédiction pour voir l'analyse.</p>
                    </div>
                {% endif %}
            </div>

            <div class="glass-card info-panel">
                <div class="header" style="margin-bottom: 1rem;">
                    <i class="fa-solid fa-circle-info"></i>
                    <h2>Qu'est-ce que le FWI ?</h2>
                </div>
                
                <div class="info-content">
                    <p>Le <strong>Fire Weather Index</strong> (FWI) est un indice utilisé mondialement pour estimer le danger de feu de forêt en fonction des conditions atmosphériques.</p>
                    
                    <ul class="risk-scale">
                        <li>
                            <span class="dot bg-low"></span>
                            <div class="scale-text">
                                <strong>0 - 10 : Risque Faible</strong>
                                <small>Conditions humides, propagation lente.</small>
                            </div>
                        </li>
                        <li>
                            <span class="dot bg-med"></span>
                            <div class="scale-text">
                                <strong>10 - 20 : Risque Modéré</strong>
                                <small>Combustible sec, départ de feu possible.</small>
                            </div>
                        </li>
                        <li>
                            <span class="dot bg-high"></span>
                            <div class="scale-text">
                                <strong>> 20 : Risque Élevé / Extrême</strong>
                                <small>Danger critique, propagation explosive.</small>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>

        </div> 

        <div class="glass-card vision-panel">
            <div class="header">
                <i class="fa-solid fa-satellite"></i>
                <h2>Vision Satellite</h2>
            </div>
            
            <p style="margin-bottom: 15px; font-size: 0.9rem; color: var(--text-muted);">
                Analysez une image satellite pour détecter des traces d'incendie.
            </p>

            <form action="{{ url_for('predict_image') }}" method="POST" enctype="multipart/form-data">
                <div class="file-upload-wrapper">
                    <input type="file" name="file" accept="image/*" required onchange="document.getElementById('file-name').textContent = this.files[0].name">
                    <i class="fa-solid fa-cloud-arrow-up upload-icon"></i>
                    <span id="file-name">Cliquez pour uploader</span>
                    <small>(.jpg, .png)</small>
                </div>

                <button type="submit" class="btn-predict" style="background: linear-gradient(135deg, #3b82f6, #8b5cf6);">
                    <i class="fa-solid fa-eye"></i> Analyser l'Image
                </button>
            </form>

            {% if image_result %}
            <div class="img-result-box">
                <div class="risk-badge {{ 'badge-high' if image_css == 'high-risk' else 'badge-low' }}">
                    RÉSULTAT
                </div>
                
                <div class="uploaded-image-container">
                    <img src="data:image/jpeg;base64,{{ uploaded_image }}" alt="Uploaded Image" class="preview-img">
                </div>

                <h3 style="font-size: 1.4rem; margin-top: 10px; color: {{ '#ef4444' if image_css == 'high-risk' else '#10b981' }}">
                    {{ image_result }}
                </h3>
                <div class="conf-score">Confiance IA : {{ image_conf }}</div>
            </div>
            {% elif img_error %}
            <div class="img-result-box" style="border-color: #ef4444;">
                <p style="color: #ef4444;">{{ img_error }}</p>
            </div>
            {% endif %}
        </div>

    </div>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>